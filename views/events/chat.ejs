<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Group Chat</title>
    <%- include('../partials/header') %>
        <style>
            #chat-box {
                height: 400px;
                overflow-y: scroll;
                border: 1px solid #ccc;
                padding: 1rem;
                background: #f9f9f9;
            }

            .message {
                margin-bottom: 10px;
            }

            .message strong {
                color: #2c3e50;
            }
        </style>
</head>

<body>
    <%- include('../partials/nav') %>

        <div class="container mt-4">
            <h2 class="mb-3">Group Chat Room</h2>

            <div id="chat-box">
                <% messages.forEach(msg=> { %>
                    <div class="message">
                        <strong>
                            <%= msg.senderName %>:
                        </strong>
                        <%= msg.message %>
                    </div>
                    <% }) %>
            </div>

            <form id="chat-form" class="mt-3">
                <input type="text" id="message" class="form-control" placeholder="Type your message..."
                    autocomplete="off" required />
                <button type="submit" class="btn btn-primary mt-2">Send</button>
            </form>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            const chatBox = document.getElementById('chat-box');
            const chatForm = document.getElementById('chat-form');
            const messageInput = document.getElementById('message');
            const user = "<%= user.name %>";

            chatForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const message = messageInput.value.trim();
                if (!message) return;
                socket.emit('chatMessage', { senderName: user, message });
                messageInput.value = '';
            });

            socket.on('newMessage', data => {
                const msgDiv = document.createElement('div');
                msgDiv.classList.add('message');
                msgDiv.innerHTML = `<strong>${data.senderName}:</strong> ${data.message}`;
                chatBox.appendChild(msgDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        </script>

        <%- include('../partials/footer') %>
</body>

</html>